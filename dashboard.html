<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth | Storm</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Zetta&family=Poppins&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: #111;
            color: white;
            text-align: center;
        }

        .header {
            position: fixed;
            top: 0;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            background: rgba(17, 17, 17, 0.6);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .header img {
            height: 35px;
            padding: 20px;
        }

        .dashboard-btn {
            font-size: 1rem;
            color: lightgray;
            text-decoration: none;
            transition: 0.3s;
            margin-right: 55px;
        }

        .dashboard-btn:hover {
            color: white;
        }

        .container {
            margin-top: 200px;
        }

        .panel {
            background: #222;
            border-radius: 15px;
            padding: 50px;
            width: 320px;
            margin: auto;
            box-shadow: 0px 0px 20px rgba(255, 255, 255, 0.3);
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .input-field {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            border: none;
            background: #333;
            color: white;
            text-align: left;
            padding-left: 10px;
        }

        .links-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
        }

        .link {
            color: lightblue;
            cursor: pointer;
            transition: 0.3s;
        }

        .link:hover {
            color: white;
        }

        .btn-full {
            width: 100%;
            background: #333;
            margin-top: 40px;
            padding: 12px;
        }

        .btn-full:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html">
            <img src="https://i.imgur.com/fiBGS25.png" alt="Storm Logo">
        </a>
        <a href="dashboard.html" class="dashboard-btn">Dashboard</a>
    </div>

    <div class="container">
        <div class="panel">
            <input type="email" id="email" class="input-field" placeholder="Email">
            <input type="password" id="password" class="input-field" placeholder="Password">
            <div class="links-container">
                <span class="link" onclick="resetPassword()">Reset Password</span>
                <span class="link" id="toggle-mode" onclick="toggleMode()">Register</span>
            </div>
            <button class="btn-full" id="auth-button" onclick="authenticate()">Login</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBClf7XcskCj2eQpeMcgEo7nDtJlK6TxmU",
            authDomain: "storm-v5.firebaseapp.com",
            databaseURL: "https://storm-v5-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "storm-v5",
            storageBucket: "storm-v5.firebasestorage.app",
            messagingSenderId: "635578156232",
            appId: "1:635578156232:web:8f47ae67074ac6fab551fd"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let isRegistering = false;

        // Check if user is already logged in
        window.onload = function() {
            const userInfo = JSON.parse(localStorage.getItem("userInfo"));
            if (userInfo) {
                showUserInfo(userInfo.userId, userInfo.email, userInfo.password, userInfo.token);
            }
        };

        function toggleMode() {
            isRegistering = !isRegistering;
            document.getElementById('toggle-mode').textContent = isRegistering ? 'Login' : 'Register';
            document.getElementById('auth-button').textContent = isRegistering ? 'Register' : 'Login';
            // Clear the input fields
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }

        function generateToken() {
            return "Storm_User_" + Array.from({ length: 20 }, () => Math.floor(Math.random() * 36).toString(36)).join('');
        }

        function authenticate() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (isRegistering) {
                // Register user
                auth.createUserWithEmailAndPassword(email, password).then(userCredential => {
                    const user = userCredential.user;
                    const token = generateToken();
                    database.ref('users/' + user.uid).set({
                        email: user.email,
                        password: password,
                        token: token
                    });
                    const userInfo = {
                        userId: user.uid,
                        email: user.email,
                        password: password,
                        token: token
                    };
                    localStorage.setItem("userInfo", JSON.stringify(userInfo)); // Store user info in localStorage
                    showUserInfo(user.uid, user.email, password, token);
                }).catch(error => alert(error.message));
            } else {
                // Log in user
                auth.signInWithEmailAndPassword(email, password).then(userCredential => {
                    const user = userCredential.user;
                    database.ref('users/' + user.uid).once('value', snapshot => {
                        if (snapshot.exists()) {
                            const userData = snapshot.val();
                            const userInfo = {
                                userId: user.uid,
                                email: userData.email,
                                password: userData.password,
                                token: userData.token
                            };
                            localStorage.setItem("userInfo", JSON.stringify(userInfo)); // Store user info in localStorage
                            showUserInfo(user.uid, userData.email, userData.password, userData.token);
                        }
                    });
                }).catch(error => alert(error.message));
            }
        }

        function showUserInfo(userId, email, password, token) {
            document.body.innerHTML = `<div class='container'><div class='panel'><h2>User Info</h2>
                <p><strong>Email:</strong> ${email}</p>
                <p><strong>Password:</strong> ${password}</p>
                <p><strong>User ID:</strong> ${userId}</p>
                <p><strong>Token:</strong> ${token}</p>
                <button class='btn-full' onclick='logout()'>Logout</button></div></div>`;
        }

        function resetPassword() {
            alert('Reset password link sent!');
        }

        // Logout function to clear localStorage and reload
        function logout() {
            localStorage.removeItem("userInfo");
            location.reload();
        }
    </script>
</body>
</html>
